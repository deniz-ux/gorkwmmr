{% extends base %}

{% block preamble %}
<!-- Bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- react-grid-layout css-->
<link rel="stylesheet" href="assets/css/react-grid-layout.css">
<!-- react-resizable css-->
<link rel="stylesheet" href="assets/css/react-resizable.css">
<!-- React development assets -->
<link href="assets/css/custom.min.css" rel="stylesheet">
<script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@latest/babel.min.js" crossorigin></script>
<!-- React-grid-layout script -->
<script src="assets/js/react-grid-layout.min.js"></script>
{% endblock %}


<!-- goes in body -->
{% block contents %}
<div class="" id="container">
  <nav class="" style="{% if header_background %}background-color: {{ header_background }} !important;{% endif %}{% if header_color %}color: {{ header_color }}{% endif %}" id="header">
    {% if nav %}
    <span style="font-size:30px;cursor:pointer" onclick="closeNav()" id="sidebar-button">
	  <div class="pn-bar"></div>
	  <div class="pn-bar"></div>
	  <div class="pn-bar"></div>
	</span>
    {% endif %}
    <a class="title" href="#">{{ app_title }}</a>
    {% for doc in docs %}
    {% for root in doc.roots %}
    {% if "header" in root.tags %}
    {{ embed(root) | indent(8) }}
    {% endif %}
    {% endfor %}
    {% endfor %}

	{% if busy %}
	<div class="pn-busy-container">
	  {{ embed(roots.busy_indicator) | indent(6) }}
	</div>
	{% endif %}

  </nav>

  <div id="content">
    {% if nav %}
    <div class="sidenav" id="sidebar">
      <ul class="nav flex-column">
        {% for doc in docs %}
        {% for root in doc.roots %}
        {% if "nav" in root.tags %}
        {{ embed(root) | indent(8) }}
        {% endif %}
        {% endfor %}
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <div class="main" id="main">
         
      <div> Hola 54

        {% for doc in docs %}
        {% for root in doc.roots %}
          <p>  {{ embed(root)| my_multiplier}}  </p>
            {% endfor %}
        {% endfor %}
      </div>
    

      <div id="mydiv" style="margin: 10px;"></div>  <!--  div for react grid layout container  -->
      


	  <div id="pn-Modal" class="pn-modal header-adjust">
		<div class="pn-modal-content">
		  <span class="pn-modalclose" id="pn-closeModal">&times;</span>
		  {% for doc in docs %}
		  {% for root in doc.roots %}
		  {% if "modal" in root.tags %}
		  {{ embed(root) | indent(10) }}
		  {% endif %}
		  {% endfor %}
      {% endfor %}
      
     

		</div>
	  </div>
    </div>
  </div>
</div>

<script>
  function openNav() {
    document.getElementById("sidebar").style.left = 0;
    document.getElementById("main").style.marginLeft = "16.7vw";
    document.getElementById("sidebar-button").onclick = closeNav;
    var interval = setInterval(function () { window.dispatchEvent(new Event('resize')); }, 10);
    setTimeout(function () { clearInterval(interval) }, 210)
  }

  function closeNav() {
    document.getElementById("sidebar").style.left = "-16.7vw";
    document.getElementById("main").style.marginLeft = 0;
    document.getElementById("sidebar-button").onclick = openNav;
    var interval = setInterval(function () { window.dispatchEvent(new Event('resize')); }, 10);
    setTimeout(function () { clearInterval(interval) }, 210)
  }

  var modal = document.getElementById("pn-Modal");
  var span = document.getElementById("pn-closeModal");

  span.onclick = function() {
    modal.style.display = "none";
  }

  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>


<script type="text/babel">
  const divStyle = {
   color: 'blue',
   background: 'red'
 };  
 
 const s2 = {
   color: 'blue',
   background: 'red'
 };  
 
 const heig = 6; 
 const ResponsiveGridLayout = ReactGridLayout.WidthProvider(ReactGridLayout.Responsive)
 var listOfObjects = []; 

   class MyFirstGrid extends React.Component {
     constructor(props) {
       super(props);
        {% for doc in docs %}
          {% for root in doc.roots %}
          {% if "main" in root.tags %}
        
              
              this.{{embed(root) | letters}} = '{{ embed(root) }}';   
            
          {% endif %}
          {% endfor %}
          {% endfor %} 
        
       } 
    
 
     get_data_root_id(tag_str){
      return tag_str.split('data-root-id=')[1].split('"')[1]
  }

  get_id(tag_str){
      return 'panel_ID_' + tag_str.split('id=')[1].split('"')[1].replace(/-/g, "");
  }

  // resize_layout(obj, old_, new_, p, e, element) {
  //    window.Bokeh.index[new_['i']].resize_layout();
  //   console.log(obj)
  // }  

  // resize_layout_stop(obj, old_, new_, p, e, element) {
  //   setTimeout(function(){
  //       console.log("I am setTimeout");
  //       window.Bokeh.index[new_['i']].resize_layout();
  //  },50);
  // }

  dragging_stop(obj, old_, new_, p, e, element) {
    // window.Bokeh.index[new_['i']].resize_layout();
    console.log('noooo', obj)
  } 

   

   render() {
     // layout is an array of objects, see the demo for more complete usage
     const layouts = { lg: [
       {i: 'b', x: 0, y: 2, w: 5.9, h: heig, minW: 2, maxW: 14},
       {i: 'c', x: 7, y: 2, w: 5.9, h: heig},
       {i: 'd', x: 0, y: 6, w: 5.9, h: heig, minW: 2, maxW: 14},
       {i: 'e', x: 7, y: 6, w: 5.9, h: heig},
       {i: 'f', x: 0, y: 10, w: 5.9, h: heig, minW: 2, maxW: 14},
       

       {% for doc in docs %}           {% for root in doc.roots %}           {% if "main" in root.tags %}              
        {i: this.get_id(this.{{ embed(root) | letters }}), x: 0, y: 23, w: 5.9, h: heig, minW: 2, maxW: 24},
       {% endif %}        {% endfor %}           {% endfor %} 

       {i: 'g', x: 7, y: 10, w: 5.9, h: heig}

     ],
     xs: [
       {i: 'b', x: 0, y: 2, w: 5.9, h: heig, minW: 2, maxW: 14},
       {i: 'c', x: 0, y: 6, w: 5.9, h: heig},
       {i: 'd', x: 0, y: 10, w: 5.9, h: heig, minW: 2, maxW: 14},
       {i: 'e', x: 0, y: 12, w: 5.9, h: heig},
       {i: 'f', x: 0, y: 16, w: 5.9, h: heig, minW: 2, maxW: 14},
       
       {% for doc in docs %}           {% for root in doc.roots %}           
              {% if "main" in root.tags %}              
                  {i: this.get_id(this.{{embed(root) | letters}}), 
                        x: 0, y: 23, w: 3.9, h: heig, minW: 2, maxW: 24},
              {% endif %}        
       {% endfor %}           {% endfor %} 

       {i: 'g', x: 0, y: 20, w: 5.9, h: heig}
     ],
 
        
     } 
  
    //  https://stackoverflow.com/questions/26088810/how-to-avoid-children-with-same-key-when-replacing-state-in-reactjs-component 

     return <ResponsiveGridLayout className="layout" layouts={layouts}
     breakpoints={% raw %}{{lg: 1200,  xs: 240}}{% endraw %}
     cols={% raw %}{{lg: 12, xs: 4}}{% endraw %}
     rowHeight={30} width={1200}
     onResize = {this.resize_layout} 
     onResizeStop = {this.resize_layout_stop}
    
     onDrag = {this.dragging_stop}
     margin={[10,10]}   draggableCancel='.bk-root' >
  
         <div key="b" style={s2}> b </div>
         <div key="c" style={s2}>c</div>
         <div key="d" style={s2}>d</div>
         <div key="e" style={s2}>holaaa</div>
         <div key="f" style={s2}>f</div>
         <div key="g" style={s2}>g</div>
 
         {% for doc in docs %}
          {% for root in doc.roots %}
          {% if "main" in root.tags %}
          <div key="{{embed(root) | letters}}" style={s2} >
          {{ embed(root) | indent(4) }}
        </div>
          {% endif %}
          {% endfor %}
          {% endfor %}
        
           </ResponsiveGridLayout>
     
   }
 }
 
 
 ReactDOM.render(<MyFirstGrid />, document.getElementById('mydiv'))
 
 </script>



{{ embed(roots.js_area) }}
{{ embed(roots.location) }}

{% endblock %}
